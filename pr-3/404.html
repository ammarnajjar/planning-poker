<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Planning Poker - Redirecting...</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: #1a1a1a;
      color: #fff;
    }
    .message {
      text-align: center;
    }
  </style>
  <script>
    // Single Page Apps for GitHub Pages
    // https://github.com/rafgraph/spa-github-pages
    // This script takes the current url and converts the path and query
    // string into just a query string, and then redirects the browser
    // to the new url with only a query string and hash fragment

    // Only run on GitHub Pages (github.io domain) to prevent issues on local dev
    var l = window.location;
    if (l.hostname.includes('github.io')) {
      // Auto-detect number of path segments to keep based on base href
      // For /planning-poker/ -> keep 1 segment
      // For /planning-poker/pr-3/ -> keep 2 segments
      var pathSegments = l.pathname.split('/').filter(function(segment) {
        return segment.length > 0;
      });

      var pathSegmentsToKeep = 1; // Default for /planning-poker/

      // If path starts with pr-{number}, we're in a PR preview
      if (pathSegments.length > 1 && pathSegments[1].match(/^pr-\d+$/)) {
        pathSegmentsToKeep = 2; // Keep /planning-poker/pr-3/
      }

      // Debug logging
      console.log('[404.html] pathname:', l.pathname);
      console.log('[404.html] pathSegments:', pathSegments);
      console.log('[404.html] pathSegmentsToKeep:', pathSegmentsToKeep);

      var redirectUrl = l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') +
        l.pathname.split('/').slice(0, pathSegmentsToKeep + 1).join('/') + '/?/' +
        l.pathname.slice(1).split('/').slice(pathSegmentsToKeep).join('/').replace(/&/g, '~and~') +
        (l.search ? '&' + l.search.slice(1).replace(/&/g, '~and~') : '') +
        l.hash;

      console.log('[404.html] Redirecting to:', redirectUrl);
      l.replace(redirectUrl);
    } else {
      // On local dev, redirect to homepage
      // For proper SPA routing on local dev, use: ng serve
      // Or: npx http-server -p 8080 --proxy http://localhost:8080?
      l.replace(l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') + '/');
    }
  </script>
</head>
<body>
  <div class="message">
    <h1>Redirecting...</h1>
    <p id="debug-info">Processing redirect...</p>
  </div>
  <script>
    // Show debug info in the page itself
    var debugEl = document.getElementById('debug-info');
    if (debugEl) {
      debugEl.innerHTML = 'Current URL: ' + window.location.href + '<br>404.html loaded successfully';
    }
  </script>
</body>
</html>
